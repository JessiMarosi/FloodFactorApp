<!-- Inside your HTML, replace spinner section and script with this -->

<!-- Spinner shown while obtaining location -->
<div id="location-spinner" style="display: none; text-align: center; margin-top: 1em;">
  <div class="spinner"></div>
  <p>Obtaining your location, please wait...</p>
</div>

<!-- Spinner shown while AI is analyzing -->
<div id="ai-spinner" style="display: none; text-align: center; margin-top: 1em;">
  <div class="spinner"></div>
  <p>Analyzing flood data, please wait...</p>
</div>

<script>
  const allowBtn = document.getElementById('allow-location-btn');
  const locateLink = document.getElementById('locate-link');
  const form = document.getElementById('flood-form');
  const locationPrompt = document.getElementById('location-prompt');
  const locationSpinner = document.getElementById('location-spinner');
  const aiSpinner = document.getElementById('ai-spinner');

  function showForm() {
    locationSpinner.style.display = 'none';
    form.style.display = 'block';
  }

  allowBtn.addEventListener('click', () => {
    if (navigator.geolocation) {
      locationSpinner.style.display = 'block';

      navigator.geolocation.getCurrentPosition(
        (position) => {
          document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
          document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
          showForm();
        },
        (error) => {
          alert('Unable to retrieve your location. Please enter coordinates manually.');
          locationSpinner.style.display = 'none';
          showForm();
        }
      );
    } else {
      alert('Geolocation is not supported by your browser. Please enter coordinates manually.');
      showForm();
    }
  });

  locateLink.addEventListener('click', () => {
    showForm();
  });

  form.addEventListener('submit', () => {
    aiSpinner.style.display = 'block';
  });
</script>
